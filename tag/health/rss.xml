<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>jekyller.github.io/jasper/</title>
   
   <link></link>
   <description>Mostly a series of why like thats</description>
   <language>en-uk</language>
   <managingEditor> </managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Eyesight and Oversight</title>
	  <link>/blog//lenskart</link>
	  <author></author>
	  <pubDate>2022-02-01T00:00:01+00:00</pubDate>
	  <guid>/blog//lenskart</guid>
	  <description><![CDATA[
	     <h2 id="lenskart">Lenskart</h2>

<p>So I have been wanting to get a pair of blue light (filtering) glasses for quite some time now. My eyes feel tired and painful causing me headaches after looking at code too long. And my vision is definitely deteriorating as well.</p>

<p>Some time ago, I had gone to Owndays with the intention of buying a pair but got turned away instead, the lady told me to just rest my eyes more. That was probably good advice but poor salesmanship. From my part-time sales job working at Challenger selling Seagate portable hard disks about 10+ years ago, I learnt to never turn away someone who is ready to spend money.</p>

<p>Recently, I started looking at Lenskart and more importantly it seems like they “nudge” you towards signing up for their gold membership. Which functions like many other faux membership to lock you in and draw more sales. It is stated that you can share the membership with your friends and family, and the primary identifier is your mobile number. I went to a physical outlet and had a rather poor experience with them. As always with salesmen, they look at your appearance to judge your spending power and guage how much time they should invest in you, in my case, my mickey mouse t-shirt and shorts probably didn’t warrant much time if any at all.</p>

<p>They didn’t attend to me at all and when I asked them questions, they give minimal effort answers.</p>

<p>However, as always, it is better to interact with websites than people, where there is no prejudice.</p>

<h3 id="lenskart-website">Lenskart Website</h3>

<p>It was quite a pleasant site and I managed to find some frames that I liked, added to cart and reached the checkout page. Where I was asked to key in a gold membership number if I have one. I was still undecided about buying them because of the poor in-person experience. But something else drawn my attention, the checking of gold membership validity.</p>

<h3 id="expired-gold-membership-and-bruteforcing">Expired gold membership and bruteforcing</h3>

<p>Naturally, the first thing I did was to try my friend’s membership, which coincidentally had just expired to my dismay. However, I did notice that it was just a simply AJAX call to check the membership status with no rate-limiting or request token. Which meant it would be relatively trivial to brute-force a valid membership.</p>

<p>I quickly whipped up something in node. And in less than a minute, I had a few hits.</p>

<p><img src="https://drive.google.com/uc?id=1EqHDr8k661B9KB3x71CgrLgcT4F3hoMM&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">Brute-forcing</span></p>

<p><img src="https://drive.google.com/uc?id=10EnJ_G6zvo9HZ7-BCmOUJFw9m4J8fO1Q&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">Found one</span></p>

<p>I prefixed the first 4 digits with my actual phone number, since phone numbers usually have shared prefixes, which increases my chances of trying an actual phone number as compared to something like 98765432, which might seem valid but might not be an actual number. This reduces the range that I have to cover.</p>

<h3 id="password-hash">Password hash</h3>

<p>After finding a hit, I was curious as to what was returned, apparently whoever made this endpoint decided it was too much effort to filter out fields, and simply returned everything from the (Mongo) DB query .</p>

<p><img src="https://drive.google.com/uc?id=1FjhKT0G5BBfMmKGqPEeCW8EbfK-IYm44&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">JSON Response</span></p>

<p>One particularly interesting field was the passwordHash, which at first glance appeared to be 32 chars, which led me to believe it is just a md5 sum of the plaintext. At this point, it could have been salted but given how lax the response was, I figured it’s probably just hashed using the plaintext.</p>

<h3 id="rainbow-tables">Rainbow tables</h3>

<p>So to confirm my suspicions, I threw the md5 into a md5 rainbow table site.</p>

<p><img src="https://drive.google.com/uc?id=1eeoeo19tsjk2-zHUSk-8VZOAQFyj1pcs&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">Password: 123456</span></p>

<p>And lo and behold, it’s the md5 of a very commonly used password: <strong>123456</strong>.</p>

<p>However, I am not sure what this password is for. It might be a password for the shop employees to use rather than the user’s password, since I don’t really see a password based login for users.</p>

<h3 id="personal-photos">Personal photos</h3>

<p>Also from some of the JSON responses, we can see a faceAnalysis prop. I believe it’s the result of lenskart’s virtual fitting of spectacles. Based on the result, we can also get a picture of the user, which probably is against PDPA. At this point, we can get their name, number and picture.</p>

<h3 id="gold-membership">Gold membership</h3>

<p>Just to be clear, you don’t actually need the password to use someone’s lenskart gold membership and there is no login with password field. Since <em>it’s meant to be shared</em>, all you need is the phone number of a valid gold member. There are even people on carousell selling their gold membership for <a href="https://www.carousell.sg/p/lenskart-1-for-1-gold-membership-1134013424/?t-id=5W_muYuMvj_1643802401331&amp;t-referrer_browse_type=search_results&amp;t-referrer_request_id=mk9gsj-lh2fk4May&amp;t-referrer_search_query=lenskart&amp;t-referrer_sort_by=popular&amp;t-tap_index=1">40 cents</a>.</p>

<p>But for me it was never about the gold membership, I am more interested at what other things could be wrong about a relatively well-known shop.</p>

<p>So I poked around abit more and found something really weird.</p>

<h4 id="what-on-earth-is-cust_is_gold">What on earth is cust_is_gold</h4>

<p>I noticed the only difference between a gold member and a non-gold, was an additional cookie.</p>

<p><strong>cust_is_gold</strong></p>

<p>Indeed, customer is always right and sometimes they are gold.</p>

<p>The logging in actually does a simple call to verify the number and subsequently sets a new cookie named “cust_is_gold” with a value of 1. This is what gets you the gold membership discount.</p>

<p>To verfiy my hypothesis, I cleared my cookies and cache, started a new cart and at the checkout page, injected my cookie.</p>

<h4 id="before-cookie-injection">Before cookie injection</h4>

<p><img src="https://drive.google.com/uc?id=1lZh8_jm1tJUzLyt3JINB1h2tSZdkeQIi&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">No discount, asked to log in</span></p>

<h4 id="after-cookie-injection">After cookie injection</h4>

<p><img src="https://drive.google.com/uc?id=1UlHQ6HoDlAjVjpV6WxK7Dy7buzDv7PZQ&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">Showing gold membership</span></p>

<h4 id="added-another-pair-of-glasses-to-reflect-the-1-for-1">Added another pair of glasses to reflect the 1-for-1</h4>

<p><img src="https://drive.google.com/uc?id=1552mkv_xNQEhKGXAkPQd4_cXvpLca_sn&amp;export=view" style="max-width: 720px" />
<span style="font-size: 12px">1-for-1 discount</span></p>

<p>I didn’t checkout, but it seems like that’s all you really need to get 1-for-1 gold membership from Lenskart through their online sales channel.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Really interesting findings from Lenskart’s site, if anything I wasn’t that keen on buying from them but after having spent some time on their sites, I now feel like getting a pair of glasses from them.</p>

	  ]]></description>
	</item>


</channel>
</rss>
